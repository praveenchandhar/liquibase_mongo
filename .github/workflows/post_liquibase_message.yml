name: Post Liquibase Usage Guide on PR Merge

on:
  pull_request:
    types:
      - closed

jobs:
  post-liquibase-guide:
    if: ${{ github.event.pull_request.merged == true }}
    runs-on: ubuntu-latest

    steps:
      - name: Post Liquibase Usage Guide
        uses: actions/github-script@v6
        env:
          MESSAGE: |
            ðŸŒŸðŸš€ **Liquibase Usage Guide** ðŸŒŸ

            Hello there! ðŸ‘‹ Ready to rock some database changes using Liquibase?

            Use the following commands in PR comments:

            âœ… `/liquibase status <db1>, <db2>`  
            âœ… `/liquibase update <db1>, <db2>`  
            âœ… `/liquibase` - Show this guide again ðŸŽ‰

            Troubleshooting:
            - Ensure jars are in `liquibase-jars`
            - Check DB connection strings
            - Validate `changelog.xml` syntax

            ðŸŽ‰ Keep rocking database updates! ðŸš€

        with:
          script: |
            const message = process.env.MESSAGE;
            const pullRequestNumber = context.payload.pull_request.number;

            github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: pullRequestNumber,
              body: message
            });
