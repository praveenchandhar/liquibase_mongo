name: Post Liquibase Usage Guide on PR Merge

on:
  pull_request:
    types:
      - closed

jobs:
  post-liquibase-guide:
    if: ${{ github.event.pull_request.merged == true }}
    runs-on: ubuntu-latest
    steps:
      - name: Post Liquibase Usage Guide
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "Posting Liquibase usage guide as a comment on the PR..."

          MESSAGE="ðŸŒŸðŸš€ **Liquibase Usage Guide** ðŸŒŸ

Hello there! ðŸ‘‹ Ready to rock some database changes using Liquibase?

Use the following commands in PR comments:

âœ… \`/liquibase status <db1>, <db2>\`  
âœ… \`/liquibase update <db1>, <db2>\`  
âœ… \`/liquibase\` - Show this guide again ðŸŽ‰

Troubleshooting:
- Ensure jars are in \`liquibase-jars\`
- Check DB connection strings
- Validate \`changelog.xml\` syntax

ðŸŽ‰ Keep rocking database updates! ðŸš€"

          curl -s -X POST \
            -H "Authorization: Bearer $GITHUB_TOKEN" \
            -H "Content-Type: application/json" \
            -d "{\"body\": \"$MESSAGE\"}" \
            "https://api.github.com/repos/${{ github.repository }}/issues/${{ github.event.pull_request.number }}/comments"
